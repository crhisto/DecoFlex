<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DecoFlex vignettes examples in Breast Cancer Data with a methylation core setup • DecoFlex</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="DecoFlex vignettes examples in Breast Cancer Data with a methylation core setup">
<meta property="og:description" content="DecoFlex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DecoFlex</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">References</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/crhisto/DecoFlex" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>DecoFlex vignettes examples in Breast Cancer
Data with a methylation core setup</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/crhisto/DecoFlex/blob/HEAD/vignettes/DecoFlex_breast_cancer_methylation_core.Rmd" class="external-link"><code>vignettes/DecoFlex_breast_cancer_methylation_core.Rmd</code></a></small>
      <div class="hidden name"><code>DecoFlex_breast_cancer_methylation_core.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configuration for the models execution. Min: 3</span></span>
<span><span class="va">iterations_big_models</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Target 3000</span></span>
<span><span class="va">iterations_small_models</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Target: 300</span></span></code></pre></div>
<p><strong>Computational Epigenomics Research group:</strong> <a href="https://epi-logos.com/" class="external-link">epi-logos.com</a></p>
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<p><code>DecoFlex</code> has been designed and developed as a
comprehensive tool for performing intricate analyses on various
datasets. The vignettes examples provided below showcase some of the
salient applications where <code>DecoFlex</code> has been successfully
employed for deconvolution:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Breast Cancer Data - Deconvolution of Methylation Core
with Expression Data</strong>: This case study provides a glimpse of how
<code>DecoFlex</code> can navigate through complex breast cancer data,
conducting a methylation core deconvolution with associated expression
data.</p></li>
<li><p><strong>Thymus Cancer Case - T-cell–specific Lymphoma Analysis
with Expression Core Deconvolution and Methylation</strong>: Here,
<code>DecoFlex</code> is employed to examine a dataset centered on
T-cell–specific lymphoma in the thymus. The analysis explores a unique
combination of expression core deconvolution and methylation
analysis.</p></li>
</ol>
<p>These examples serve as an excellent primer to comprehend the
capabilities of <code>DecoFlex</code> in handling complex omics data
analyses. They could also act as a template for conducting your own
unique analyses with your datasets. For any queries, feedback, or
suggestions, please feel free to reach out to us.</p>
<p>For those interested in gaining a deeper understanding of the
technical and methodological underpinnings of the DecoFlex approach, we
recommend reading our comprehensive research paper:</p>
<ul>
<li>Cardona, C., Schweikert, G., et al. (2023). “DecoFlex: A Flexible
Joined Cell-Type Decomposition with Multiomic Epigenetic Data.”
Published on bioRxiv. You can access the paper directly via this <a href="https://doi.org/10.1101/xxxxxx" class="external-link">link</a>.</li>
</ul>
<p>This paper delves into the nuanced workings of DecoFlex and provides
a comprehensive exploration of the algorithm’s design and performance.
It also highlights its application in diverse use-cases, emphasizing its
flexibility and adaptability in dealing with multiomic epigenetic
data.</p>
</div>
<div class="section level2">
<h2 id="introduction-vignette-1">Introduction (vignette #1)<a class="anchor" aria-label="anchor" href="#introduction-vignette-1"></a>
</h2>
<p>This vignette centers on the development and application of the
DecoFlex R package, inspired by and tested against the Breast Cancer
dataset from <a href="10.1016/j.celrep.2016.10.057">Onuchic V, et al,
2016</a>. The dataset is comprised of 300 in silico mixtures, with 100
normal and 200 cancer simulations, featuring diverse cell types’
methylation and gene expression profiles. (For a more detailed
understanding, please refer to the original paper).</p>
<p>Our initial analyses incorporated the Edec reference methylation
profiles, which correspond to the same cell class as the mixed samples,
albeit from different cell types (e.g., various breast cancer cell
lines). We initially emulated the authors’ approach, an endeavor that
can be followed here: <a href="https://github.com/BRL-BCM/EDec/blob/master/vignettes/EDec_usage_example.Rmd" class="external-link uri">https://github.com/BRL-BCM/EDec/blob/master/vignettes/EDec_usage_example.Rmd</a>.
Our goal was to accurately recover the methylation and expression
matrices, along with the proportions of three specific cell types:
Stromal, Epithelial, and Immune, in both cancerous and normal cells.</p>
<p>Subsequently, we explored how DecoFlex could correctly identify all
six cell type proportions, in conjunction with their respective
methylation and gene expression profiles. Finally, we utilized
DecoFlex’s extended functionality to investigate the relationship
between methylation and expression data, implementing a third, Z matrix
that generates a B output matrix.</p>
<p>This tutorial will cover the following content:</p>
<ol style="list-style-type: decimal">
<li>Installation and Setup</li>
<li>Data Acquisition</li>
<li>Simple Deconvolution</li>
<li>Separate Deconvolutions: Cancer and Normal</li>
<li>Recovering Proportions of Six Cell Types (Cancer, Normal)</li>
<li>Deconvolution with Auxiliary Matrices (Z input, B output)</li>
</ol>
</div>
<div class="section level2">
<h2 id="installation-and-setup">1. Installation and setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h2>
<p>Firstly, to utilize sparse matrices in R, we need to install two
modified libraries: <a href="https://github.com/Bioconductor/Biobase" class="external-link">Biobase</a> and <a href="https://github.com/renozao/xbioc" class="external-link">xbioc</a>. Subsequently, we will
be incorporating an enhanced version of the <a href="https://meichendong.github.io/SCDC/articles/SCDC.html" class="external-link">SCDC</a>
library, which has undergone revisions to support sparse matrices,
facilitate parallel processing, enable dynamic threshold for marker
selection, among other advancements. Lastly, the necessary general
libraries required for the entire pipeline execution will be
imported.</p>
<p>Importing the library</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/crhisto/DecoFlex" class="external-link">DecoFlex</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-adquisition">2. Data adquisition<a class="anchor" aria-label="anchor" href="#data-adquisition"></a>
</h2>
<p>First let’s load the Edec datasets from the github repository</p>
<p>We will now proceed to load the datasets that will be utilized.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/reference_meth.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/reference_meth_class.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/meth_mixtures.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/gene_exp_mixtures.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/true_cell_type_meth.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/true_cell_type_props.rda'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">'data/true_cell_type_gene_exp.rda'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="feature-selection">3. Feature selection<a class="anchor" aria-label="anchor" href="#feature-selection"></a>
</h2>
<p>We utilized Edec’s Stage 0 to select the top 500 CpG loci, crucial in
defining cell type identity from the methylation references, using the
one vs rest strategy. We believe this is a classic, straightforward, and
proven method for identifying features that may characterize the
samples. In addition, the authors demonstrated that employing this
strategy led to superior results, particularly in terms of identifying
the subset of CpG loci.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Selecting marker loci based on comparisons of each class of reference against</span></span>
<span><span class="co"># all other samples</span></span>
<span><span class="va">markers_ovr</span> <span class="op">&lt;-</span> <span class="fu">EDec</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EDec/man/run_edec_stage_0.html" class="external-link">run_edec_stage_0</a></span><span class="op">(</span>reference_meth <span class="op">=</span> <span class="va">reference_meth</span>,</span>
<span>                         reference_classes <span class="op">=</span> <span class="va">reference_meth_class</span>,</span>
<span>                         max_p_value <span class="op">=</span> <span class="fl">1e-5</span>,</span>
<span>                         num_markers <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                         version <span class="op">=</span> <span class="st">"one.vs.rest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simple-deconvolution">4. Simple deconvolution<a class="anchor" aria-label="anchor" href="#simple-deconvolution"></a>
</h2>
<p>Let’s begin by executing a straightforward deconvolution with both
delta and alpha set to zero, a procedure equivalent to Normal NMF. We’ll
use the methylation mixture, previously filtered for the top 500 CpGs,
as our input. The aim is to identify four cell types or methylomes that
align with the public methylation reference. Similar to Edec, we’re
aware that the actual cell type composition is six, but the most
representative grouping is seen within four clusters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#delta_threshold</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fl">1e-20</span>, scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0.00000000000000000001"</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For the reticulate library I have to specify the parameter type.</span></span>
<span><span class="va">deco.alpha.beta.zero.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_complete_deconvolution.html">run_complete_deconvolution</a></span><span class="op">(</span></span>
<span>  x_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  y_matrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  z_matrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  beta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  delta_threshold<span class="op">=</span><span class="fl">1e-20</span>, </span>
<span>  max_iterations<span class="op">=</span><span class="va">iterations_big_models</span><span class="op">)</span></span>
<span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 8.205878 secs</span></span></code></pre></div>
<p>Now, let’s assess the outcomes of the deconvolution:</p>
<ol style="list-style-type: decimal">
<li>We will examine the progression of the divergence value until the
end of the executions, both in their normal and scaled forms.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_deconvolution_performance_x_y_z_total.html">plot_deconvolution_performance_x_y_z_total</a></span><span class="op">(</span></span>
<span>  <span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">running_info</span>,</span>
<span>  alpha<span class="op">=</span><span class="fl">0</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  scale_parameters <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.deconvolution.getting.w.delta.alpha.zero.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_deconvolution_performance_x_y_z_total.html">plot_deconvolution_performance_x_y_z_total</a></span><span class="op">(</span></span>
<span>  <span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">running_info</span>,</span>
<span>  alpha<span class="op">=</span><span class="fl">0</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  scale_parameters <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.deconvolution.getting.w.delta.alpha.zero.performance-2.png" width="480"></p>
<ol start="2" style="list-style-type: decimal">
<li>We will analyze heatmaps that depict the correlation between the
Matrix W (calculated methylation profiles) and the public methylation
reference, in addition to the true methylation profiles.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">plot_heatmap_correlation_deconvolution_vs_true_Edec</span><span class="op">(</span></span>
<span>  <span class="va">reference_meth</span>,</span>
<span>  <span class="va">reference_meth_class</span>, </span>
<span>  <span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">w</span>, </span>
<span>  <span class="va">markers_ovr</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.deconvolution.getting.w.delta.alpha.zero.results-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">plot_Edec.estimated.profiles.vs.truly.mixtures</span><span class="op">(</span></span>
<span>  <span class="va">true_cell_type_meth</span>,</span>
<span>  <span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">w</span>,</span>
<span>  <span class="va">markers_ovr</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.deconvolution.getting.w.delta.alpha.zero.results-2.png" width="672"></p>
<p>To assess the proportions accurately, we combine the cancer and
normal tissues for comparison.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_2"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer epithelial proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_0"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal epithelial proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_1"</span><span class="op">]</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerImmune"</span>,<span class="st">"NormalImmune"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True immune proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_3"</span><span class="op">]</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerStroma"</span>,<span class="st">"NormalStroma"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stromal proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True stromal proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.deconvolution.getting.w.delta.alpha.zero.results.proportions.comparison-1.png" width="672"></p>
<p>Considering that the proportions of Epithelium appear satisfactory,
but Stroma and Immune proportions do not, we will now combine the normal
and cancer samples for these two categories. Afterward, we will
reevaluate the correlation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">true.proportions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerEpithelium"</span>, <span class="st">"NormalEpithelium"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                          Stromal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerStroma"</span>,<span class="st">"NormalStroma"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                          Immune <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerImmune"</span>,<span class="st">"NormalImmune"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#checking proportions: 300</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true.proportions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300</span></span>
<span></span>
<span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.decoflex.vs.true.proportions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true.proportions</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.9921054</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions</span><span class="op">[</span><span class="va">cors.decoflex.vs.true.proportions</span><span class="op">&gt;=</span><span class="fl">.985</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="co"># Create a color gradient to be used in a heatmap of correlations</span></span>
<span><span class="va">color_gradient</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true proportions vs deconflex calculation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.join.proportions-1.png" width="672"></p>
<p>Next, we will merge the proportions obtained from both cancer and
normal samples in the decoflex results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine proportions of cancer and normal epithelial cell types</span></span>
<span><span class="va">decoflex.combined_proportions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rank_0"</span>,<span class="st">"rank_2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_3"</span><span class="op">]</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">deco.alpha.beta.zero.results</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"rank_1"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Epithelial"</span>,</span>
<span>                                   <span class="st">"Stromal"</span>,</span>
<span>                                   <span class="st">"Immune"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Checking if the proportions by sample and in total are 300</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="separated-deconvolutions-cancer-and-normal">5. Separated deconvolutions: Cancer and normal<a class="anchor" aria-label="anchor" href="#separated-deconvolutions-cancer-and-normal"></a>
</h2>
<p>Following this, we will proceed to replicate the model by separating
the deconvolutions into two categories: cancer and normal cells. By
fixing H, which represents the proportions of the three cell types
(Epithelial, Stromal, and Immune) in cancer distinct from normal cells,
we can compare its similarity to the authentic expression profile.
Simultaneously, we will generate distinct methylation profiles for
cancer and normal tissue. Subsequent comparison of these profiles will
allow us to discern their differences. As the three cell types are
combined, k is set to 3, and a comprehensive examination will be
conducted for normal cells, encompassing w (the calculated methylation
profiles) and a (the calculated expression profile).</p>
<div class="section level3">
<h3 id="cancer-samples">5.1. Cancer samples<a class="anchor" aria-label="anchor" href="#cancer-samples"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># #Let's try the deconvolution method library</span></span>
<span><span class="co"># NMMFlex &lt;- import('NMMFlex')</span></span>
<span><span class="co"># NMMFlex_grid_search &lt;- NMMFlex$grid_search()</span></span>
<span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.00001</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Running the deconvolution</span></span>
<span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="va">iterations_small_models</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference of  mins hours: 3.16 hours for 300 iterations: 5:20pm. Actual 2.30 hours</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 1.862624 mins</span></span></code></pre></div>
<p>To select the optimal model, we based our decision on the alpha
value, as the beta value remains consistently zero.</p>
<p>Let’s examine the behavior of the grid search process to gain
insights into its performance.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 8"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 9"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 10"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 11"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.plots-1.png" width="576"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.plots-2.png" width="576"></p>
<p>Let’s now examine the correlation between matrix A (expression
profile) and the actual expression profile for cancer cells. The
preliminary analysis suggests a strong correlation with the reference
expression dataset.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model.tumors.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.00001</span>, beta<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot estimated transcription profiles against the true cell </span></span>
<span><span class="co"># type specific transcription profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated epithelial transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerStroma"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stromal transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer stromal transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerImmune"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer immune transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.correlation.expression-1.png" width="384"></p>
<p>We observe a strong correlation between matrix A and the cancer
expression profiles, with a coefficient of 0.997842, indicating a
significant association.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.expression.cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_gene_exp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerEpithelium"</span>, <span class="st">"CancerStroma"</span>, <span class="st">"CancerImmune"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                           <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.997842</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.expression.cancer</span><span class="op">[</span><span class="va">cors.expression.cancer</span><span class="op">&gt;=</span><span class="fl">.997</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.expression.cancer</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.expression.cancer</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true expression profiles vs deconflex calculation (Cancer)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.correlation.expression.all-1.png" width="672"></p>
<p>Then, let’s examine the methylation profile specifically related to
cancer.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer epithelial"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stroma"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer stroma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer immune"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.correlation.methylation-1.png" width="384"></p>
<p>Furthermore, we find a notable correlation of 0.9827916 between the
methylation profile and the cancer-related data, indicating a strong
relationship between the two.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.methylation.cancer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CancerEpithelium"</span>, <span class="st">"CancerStroma"</span>, <span class="st">"CancerImmune"</span><span class="op">)</span><span class="op">]</span>, <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.9827916</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.methylation.cancer</span><span class="op">[</span><span class="va">cors.methylation.cancer</span><span class="op">&gt;=</span><span class="fl">.965</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.methylation.cancer</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.methylation.cancer</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true methylation profiles vs deconflex calculation (Cancer)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumors.correlation.methylation.all-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="normal-samples">5.2. Normal samples<a class="anchor" aria-label="anchor" href="#normal-samples"></a>
</h3>
<p>Now, we will repeat the same process with the normal samples from the
in silico mixtures.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.00001</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="va">iterations_small_models</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span><span class="op">[</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference of  mins hours: 1.66 hours for 300 iterations: 6:40pm. Real: 1.20 hours</span></span>
<span><span class="co">#Final number of iterations:  300  Divergence:  1874591464.911863  Delta divergence:  3855.57200050354</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 51.33977 secs</span></span></code></pre></div>
<p>Let’s examine the behavior of the grid search algorithm to gain
insights into its performance.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 8"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 9"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 10"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 11"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plots-1.png" width="576"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plots-2.png" width="576"></p>
<p>Now, let’s assess the correlation between the matrix A (expression
profile) and the actual expression profile for normal cells. The results
indicate a strong correlation, suggesting a close alignment between the
two.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.normal.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal</span>, alpha <span class="op">=</span> <span class="fl">0.00001</span>, beta<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot estimated transcription profiles against the true cell </span></span>
<span><span class="co"># type specific transcription profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated epithelial transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalStroma"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stromal transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal stroma transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalImmune"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal immune transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.correlation.expression-1.png" width="384"></p>
<p>The correlation between the matrix A (expression profile) and the
actual expression profile for normal cells is excellent, with a
coefficient of 0.9905838, indicating a high level of agreement.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.expression.normal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_gene_exp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NormalEpithelium"</span>, <span class="st">"NormalStroma"</span>, <span class="st">"NormalImmune"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                           <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.9905838 </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.expression.normal</span><span class="op">[</span><span class="va">cors.expression.normal</span><span class="op">&gt;=</span><span class="fl">.98</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.expression.normal</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.expression.normal</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true expression profiles vs deconflex calculation (Normal)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.correlation.expression.all-1.png" width="672"></p>
<p>Next, let’s examine the methylation profile specifically related to
normal cells.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal epithelial"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stroma"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal stroma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal immune"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.correlation.methylation-1.png" width="384"></p>
<p>We also find a commendable correlation of 0.9824257 between the
methylation profile and the normal cell data, indicating a strong
relationship between the two.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.methylation.normal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NormalEpithelium"</span>, <span class="st">"NormalStroma"</span>, <span class="st">"NormalImmune"</span><span class="op">)</span><span class="op">]</span>, <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.9824257</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.methylation.normal</span><span class="op">[</span><span class="va">cors.methylation.normal</span><span class="op">&gt;=</span><span class="fl">.975</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.methylation.normal</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.methylation.normal</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true methylation profiles vs deconflex calculation (Normal)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.correlation.methylation.all-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="complete-expression-profile">5.3. Complete expression profile<a class="anchor" aria-label="anchor" href="#complete-expression-profile"></a>
</h3>
<p>Next, I aim to consolidate a unified dataset and generate a
comparison plot using the calculated expression profiles from both
cancer and normal samples.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model.tumors.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.tumors</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.00001</span>, beta<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.normal.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta_zero.normal</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.00001</span>, beta<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot estimated transcription profiles against the true cell </span></span>
<span><span class="co"># type specific transcription profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated epithelial transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated epithelial transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerStroma"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stromal transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer stromal transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalStroma"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stromal transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal stroma transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"CancerImmune"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune transcription profile in tumors"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer immune transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_gene_exp</span><span class="op">[</span>,<span class="st">"NormalImmune"</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune transcription profile in normal samples"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal immune transcription profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.together-1.png" width="672"></p>
<p>The combined expression profile demonstrates a significant
correlation of 0.9942129 with the true cell type profile, indicating a
strong agreement between the two.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">decoflex.deco.data.expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"decoflex.CancerEpithelium"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>                    <span class="st">"decoflex.NormalEpithelium"</span> <span class="op">=</span> <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.CancerStromal"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.NormalStromal"</span><span class="op">=</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.CancerImmune"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.NormalImmune"</span><span class="op">=</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.expression.tumor.normal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_gene_exp</span>, <span class="va">decoflex.deco.data.expression</span><span class="op">)</span></span>
<span><span class="co">#mean r pearson correlation = 0.9942129</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.expression.tumor.normal</span><span class="op">[</span><span class="va">cors.expression.tumor.normal</span><span class="op">&gt;</span><span class="fl">.90</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.expression.tumor.normal</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.expression.tumor.normal</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true expresion profiles vs deconflex calculation (cancer, Normal)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.together.correlation.expression-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="complete-expression-profile-1">5.4. Complete expression profile<a class="anchor" aria-label="anchor" href="#complete-expression-profile-1"></a>
</h3>
<p>Let’s proceed by combining the methylation profiles of both cancer
and normal samples for further analysis.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer epithelial"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal epithelial"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stroma"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer stroma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated stroma"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal stroma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"CancerImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer immune"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="st">"NormalImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated immune"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal immune"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.together.correlation.methylation-1.png" width="672"></p>
<p>Upon combining the methylation profiles of cancer and normal samples,
we find that the joint expression profile exhibits a remarkable
correlation of 0.9826087 with the true cell type profile, indicating a
strong agreement between the two.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">decoflex.deco.data.methylation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"decoflex.CancerEpithelium"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>                    <span class="st">"decoflex.NormalEpithelium"</span> <span class="op">=</span> <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.CancerStromal"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.NormalStromal"</span><span class="op">=</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.CancerImmune"</span><span class="op">=</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>, </span>
<span>                    <span class="st">"decoflex.NormalImmune"</span><span class="op">=</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.methylation.tumor.normal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_meth</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="op">]</span>, <span class="va">decoflex.deco.data.methylation</span><span class="op">)</span></span>
<span><span class="co">#mean r pearson correlation = 0.9826087</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.methylation.tumor.normal</span><span class="op">[</span><span class="va">cors.methylation.tumor.normal</span><span class="op">&gt;</span><span class="fl">.965</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.methylation.tumor.normal</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.methylation.tumor.normal</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true methylation profiles vs deconflex calculation (cancer, Normal)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.together.all-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="differences-between-cancer-and-normal-methylation-profiles">5.5. Differences between cancer and normal methylation profiles<a class="anchor" aria-label="anchor" href="#differences-between-cancer-and-normal-methylation-profiles"></a>
</h3>
<p>Lastly, we aim to investigate the distinguishing factors in the
methylation profiles of cancer and normal tissues, which contribute to
the divergent methylome between normal and tumor samples, particularly
concerning CpGs.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Epithelial"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated tumor Epithelium"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Estimated normal Epithelium"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Stromal"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated tumor Stroma"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Estimated normal Stroma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,</span>
<span>     <span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">[</span>,<span class="st">"Immune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated tumor immune"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Estimated normal immune"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.vs.tumor-1.png" width="1056"></p>
<ol start="5" style="list-style-type: decimal">
<li>Recovering Proportions of Six Cell Types (Cancer, Normal)</li>
</ol>
<p>Our next objective is to compute the proportions for all six cell
types: normal and cancer, for each pure cell type in a comprehensive
model. To achieve this, we amalgamate the results of the W matrix
(calculated methylation profiles) and A matrix (calculated expression
profile) from the normal and tumor deconvolution models. Our aim is to
accurately recover the true proportions of each normal and cancer
sample, which was not feasible in the first and second steps, as we only
calculated the proportions for the three cell types, treating cancer and
normal together.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Lets build W, A in order to get H.</span></span>
<span><span class="va">W_methylation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span>, <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">W_methylation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normalEpithelial'</span>, <span class="st">'normalStromal'</span>, <span class="st">'normalImmune'</span>,</span>
<span>                                      <span class="st">'cancerEpithelial'</span>, <span class="st">'cancerStromal'</span>, <span class="st">'cancerImmune'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">A_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span>, <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">A_expression</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normalEpithelial'</span>, <span class="st">'normalStromal'</span>, <span class="st">'normalImmune'</span>,</span>
<span>                                      <span class="st">'cancerEpithelial'</span>, <span class="st">'cancerStromal'</span>, <span class="st">'cancerImmune'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.00001</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="va">iterations_small_models</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W_methylation</span><span class="op">)</span>,</span>
<span>  fixed_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">A_expression</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference: each iteration: 1.852337 min, 150=4,63 hours, 200=6.17 hours (real 5.52201 hours)</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 2.757589 mins</span></span></code></pre></div>
<p>Let’s analyze the performance and behavior of the grid search
algorithm.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.plots-1.png" width="576"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.plots-2.png" width="576"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#lets choose one model</span></span>
<span><span class="va">model.tumors.normal.w.a.fixed.nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.alpha.list.tumors.normal</span>, alpha <span class="op">=</span> <span class="fl">0.00001</span>, beta<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>To evaluate the proportions effectively, we combine the cancer and
normal tissues for analysis.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"cancerEpithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"CancerEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer epithelial proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer epithelial proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"normalEpithelial"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"NormalEpithelium"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal epithelial proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal epithelial proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"normalImmune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"NormalImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal Immune proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal Immune proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"cancerImmune"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"CancerImmune"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer Immune proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer Immune proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"normalStromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"NormalStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated normal Stromal proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True normal Stromal proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">[</span>,<span class="st">"cancerStromal"</span><span class="op">]</span>,</span>
<span>     <span class="va">true_cell_type_props</span><span class="op">[</span>,<span class="st">"CancerStroma"</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"steelblue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Estimated cancer Stromal proportion"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True cancer Stromal proportion"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.proportions.comparison-1.png" width="672"></p>
<p>We have obtained a strong correlation of 0.9972367 between all the
proportions and the actual values. Specifically, the correlation for the
normal samples is 0.9917114, and for the cancer samples, it is 0.99.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#checking proportions: 300</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">true_cell_type_props</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300</span></span>
<span></span>
<span><span class="co">#checking the correlation</span></span>
<span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">true_cell_type_props</span>,</span>
<span>                                                     <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#mean r pearson correlation = 0.9972367</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span><span class="op">[</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span><span class="op">&gt;=</span><span class="fl">.985</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="co">#NORMAL: mean r pearson correlation = 0.9917114</span></span>
<span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.normal</span> <span class="op">&lt;-</span> <span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NormalEpithelium'</span>, <span class="st">'NormalStroma'</span>, <span class="st">'NormalImmune'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normalEpithelial'</span>, <span class="st">'normalStromal'</span>, <span class="st">'normalImmune'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.normal</span><span class="op">[</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.normal</span><span class="op">&gt;=</span><span class="fl">.97</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="co">#TUMOR: mean r pearson correlation = </span></span>
<span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.cancer</span> <span class="op">&lt;-</span> <span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CancerEpithelium'</span>, <span class="st">'CancerStroma'</span>, <span class="st">'CancerImmune'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cancerEpithelial'</span>, <span class="st">'cancerStromal'</span>, <span class="st">'cancerImmune'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.cancer</span><span class="op">[</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes.cancer</span><span class="op">&gt;=</span><span class="fl">.97</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span>,</span>
<span>                  cellnote <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cors.decoflex.vs.true.proportions.6.celltypes</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  col<span class="op">=</span><span class="fu">color_gradient</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                  breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">1</span>, cexCol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Correlation: true proportions vs deconflex calculation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.single.model.proportions.correlation-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="deconvolution-with-auxiliary-matrices-z-input-b-output">7. Deconvolution with Auxiliary matrices Z input, B output<a class="anchor" aria-label="anchor" href="#deconvolution-with-auxiliary-matrices-z-input-b-output"></a>
</h2>
<p>Taking advantage of DecoFlex’s flexible configuration, we will now
fix W (the calculated methylation patterns), A (the calculated
expression patterns), and H (proportions) to generate matrix B. This
will be accomplished by leveraging the additional information provided
through matrix Z, as described below.</p>
<div class="section level3">
<h3 id="creating-z-matrix">7.1. Creating Z matrix<a class="anchor" aria-label="anchor" href="#creating-z-matrix"></a>
</h3>
<p>Let’s construct the auxiliary matrix corresponding to the Z matrix.
During this research phase, we need to develop the following
strategies:</p>
<ol style="list-style-type: decimal">
<li>As each row represents a CpG and each column symbolizes a sample,
it’s necessary to summarize the expression for each CpG X Sample. The
goal is to evaluate the expression value within the vicinity of 100bp
after the CpG.</li>
</ol>
<p>Since our methylation data is sourced from the InfiniumMethylation
hg19 platform, it’s vital to employ the appropriate method to translate
the cg####### (ID_REF) code. This allows us to retrieve the genomic
position.</p>
<p>For more information about GenomicRanges, visit: <a href="https://bioconductor.org/packages/devel/bioc/vignettes/GenomicRanges/inst/doc/GenomicRangesIntroduction.html" class="external-link uri">https://bioconductor.org/packages/devel/bioc/vignettes/GenomicRanges/inst/doc/GenomicRangesIntroduction.html</a></p>
<p>We can create an additional auxiliary matrix, Z, by incorporating the
division of expression by methylation as a factor or score.</p>
<p>Additionally, we can create an auxiliary matrix, Z, that summarizes
the information by calculating the expression divided by methylation as
a factor or score. This calculation will be performed separately for
cancer and normal samples to provide a consolidated summary.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">methylation.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">)</span></span>
<span><span class="co"># expression for nearest Gene of the CpG divided between methylation.</span></span>
<span><span class="va">expression_bulk_samples.auxiliary.summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>tumor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                                normal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">methylation.summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>tumor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">methylation.data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                                normal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">methylation.data</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">expression_bulk_samples.auxiliary.score.summ.tumor.normal</span> <span class="op">&lt;-</span> <span class="va">expression_bulk_samples.auxiliary.summ</span><span class="op">/</span><span class="va">methylation.summ</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary.summ</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Let's see if there are infinite or na values.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary.score.summ.tumor.normal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary.score.summ.tumor.normal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer(0)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="deconvolution-for-normal-and-cancer-data-together">7.2. Deconvolution for normal and cancer data together<a class="anchor" aria-label="anchor" href="#deconvolution-for-normal-and-cancer-data-together"></a>
</h3>
<p>We will calculate the B matrix using the Z matrix, incorporating the
scores for all six cell types (both normal and cancer) for each pure
cell type.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Lets build W, A in order to get H.</span></span>
<span><span class="va">W_methylation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">w</span>, <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">W_methylation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normalEpithelial'</span>, <span class="st">'normalStromal'</span>, <span class="st">'normalImmune'</span>,</span>
<span>                                      <span class="st">'cancerEpithelial'</span>, <span class="st">'cancerStromal'</span>, <span class="st">'cancerImmune'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">A_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model.normal.nmf</span><span class="op">$</span><span class="va">a</span>, <span class="va">model.tumors.nmf</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">A_expression</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normalEpithelial'</span>, <span class="st">'normalStromal'</span>, <span class="st">'normalImmune'</span>,</span>
<span>                                      <span class="st">'cancerEpithelial'</span>, <span class="st">'cancerStromal'</span>, <span class="st">'cancerImmune'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#I got the actual proportions fixed for the best</span></span>
<span><span class="va">H_proportions</span> <span class="op">&lt;-</span> <span class="va">model.tumors.normal.w.a.fixed.nmf</span><span class="op">$</span><span class="va">h</span></span>
<span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.00001</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">beta_values.list</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.00001</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary.score</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="va">beta_values.list</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">iterations_small_models</span><span class="op">)</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  delta_threshold<span class="op">=</span><span class="fl">1e-20</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W_methylation</span><span class="op">)</span>,</span>
<span>  fixed_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">A_expression</span><span class="op">)</span>, </span>
<span>  fixed_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">H_proportions</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference: each iteration: 24 sec, 150=(24*150)/60/60= 1 hours, 200=(24*200)/60/60 =  1.33 hours (real  hours)</span></span>
<span><span class="co">#Final number of iterations:  200  Divergence:  40600720.00004679  Delta divergence:  1.6056352332234383</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 43.0504 secs</span></span></code></pre></div>
<p>Let’s analyze the behavior and performance of the grid search
algorithm.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 8"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 9"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 10"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 11"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 12"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 13"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 14"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 15"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 16"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 17"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 18"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 19"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 20"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 21"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 22"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 23"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 24"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 25"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 26"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 27"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 28"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 29"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 30"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 31"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 32"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 33"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 34"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 35"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 36"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 37"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 38"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 39"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 40"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 41"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 42"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 43"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 44"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 45"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 46"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 47"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 48"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 49"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.plots-1.png" width="480"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.a.h.alpha.list.tumors.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.plots-2.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="creation-of-z-matrix-for-normal-separated">7.3. Creation of Z matrix for normal separated<a class="anchor" aria-label="anchor" href="#creation-of-z-matrix-for-normal-separated"></a>
</h3>
<p>I will attempt to extract the normal profiles of the three cell types
using the auxiliary matrix for the normal samples.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">beta_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary</span><span class="op">[</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="va">beta_values.list</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="va">iterations_small_models</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span><span class="op">[</span>, <span class="fl">201</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference of  mins hours: 3.33 hours for 500 iterations: 9pm. Actual 2.331292 hours. 3000: 15 hours:  12.78012 hours</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 1.809499 mins</span></span></code></pre></div>
<p>Let’s examine the behavior of the grid search process to gain
insights into its performance.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 8"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 9"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 10"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 11"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 12"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 13"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 14"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 15"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 16"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 17"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 18"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 19"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 20"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 21"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 22"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 23"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 24"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 25"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu">DecoFlex</span><span class="fu">::</span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.plots-1.png" width="480"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.plots-2.png" width="480"></p>
<p>Now, we can explore the detailed divergence observed in each matrix
(x, y, z) to gain a comprehensive understanding of the differences.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#detailed plots with divergence in x, y, z.</span></span>
<span><span class="fu">DecoFlex</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_performance_for_each_model.html">plot_performance_for_each_model</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal</span>, plot_type <span class="op">=</span> <span class="st">'detailed'</span>, save.pdf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-1.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-2.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-3.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-4.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-5.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-6.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-7.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-8.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-9.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-10.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-11.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-12.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-13.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-14.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-15.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-16.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-17.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-18.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-19.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-20.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-21.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-22.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-23.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-24.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.results.performance.detailed-25.png" width="480"></p>
<p>Let’s examine the patterns that we have discovered in the matrix B
for the normal samples.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model.alpha.beta.op.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.normal</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Normal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.fixed.b.matrix-1.png" width="1056"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.normal</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Normal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.plus.z.fixed.b.matrix-2.png" width="1056"></p>
</div>
<div class="section level3">
<h3 id="creation-of-z-matrix-for-cancer-separated">7.4. Creation of Z matrix for cancer separated<a class="anchor" aria-label="anchor" href="#creation-of-z-matrix-for-cancer-separated"></a>
</h3>
<p>I will attempt to extract the cancer profiles of the three cell types
using the auxiliary matrix.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alpha_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">beta_values.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_grid_search.html">run_grid_search</a></span><span class="op">(</span></span>
<span>  bulk_data_methylation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">meth_mixtures</span><span class="op">[</span><span class="va">markers_ovr</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  bulk_data_expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gene_exp_mixtures</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  data_expression_auxiliary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">expression_bulk_samples.auxiliary</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  alpha_list <span class="op">=</span> <span class="va">alpha_values.list</span>, </span>
<span>  beta_list <span class="op">=</span> <span class="va">beta_values.list</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="va">iterations_small_models</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  proportion_constraint_h <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  fixed_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">decoflex.combined_proportions</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Time difference of  mins hours: 5.5 hours for 500 iterations: 7am. Actual 4.535179 hours. 1000 10 hours (8 pm) 1.078599 days</span></span>
<span><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span></span>
<span><span class="co">#&gt; Time difference of 3.766782 mins</span></span></code></pre></div>
<p>Let’s analyze the behavior and performance of the grid search
algorithm to gain insights into its effectiveness.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataframe_results_multiple_deconvolutions.html">create_dataframe_results_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Model: 1"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 2"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 3"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 4"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 5"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 6"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 7"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 8"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 9"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 10"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 11"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 12"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 13"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 14"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 15"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 16"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 17"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 18"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 19"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 20"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 21"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 22"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 23"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 24"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span><span class="co">#&gt; [1] "Model: 25"</span></span>
<span><span class="co">#&gt; [1] "Running information:"</span></span>
<span></span>
<span><span class="co">#Performance plots</span></span>
<span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.plots.performance-1.png" width="480"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span>, main_parameter <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.plots.performance-2.png" width="480"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performance_plot_multiple_deconvolutions.html">performance_plot_multiple_deconvolutions</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span>, main_parameter <span class="op">=</span> <span class="st">'alpha'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.plots.performance-3.png" width="480"></p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span>, fill_value <span class="op">=</span> <span class="st">'log_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.plots-1.png" width="480"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap_alpha_beta.html">plot_heatmap_alpha_beta</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors.df</span>, fill_value <span class="op">=</span> <span class="st">'log_delta_divergence_value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.plots-2.png" width="480"></p>
<p>Now, we can examine the detailed divergence present in each matrix
(x, y, z) to gain a comprehensive understanding of the variations.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Detailed plots with divergence in x, y, z.</span></span>
<span><span class="fu"><a href="../reference/plot_performance_for_each_model.html">plot_performance_for_each_model</a></span><span class="op">(</span><span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors</span>, plot_type <span class="op">=</span> <span class="st">'detailed'</span>, save.pdf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-1.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-2.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-3.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-4.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-5.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-6.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-7.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-8.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-9.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-10.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-11.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-12.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-13.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-14.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-15.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-16.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-17.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-18.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-19.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-20.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-21.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-22.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-23.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-24.png" width="480"><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.results.performance.detailed-25.png" width="480"></p>
<p>Let’s examine the patterns that we have discovered in the matrix B
for the cancer samples.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model.alpha.beta.op.tumor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.0001</span>, beta <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.tumor</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Cancer"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.fixed.b.matrix-1.png" width="1056"></p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.tumor</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Cancer"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.tumor.plus.z.fixed.b.matrix-2.png" width="1056"></p>
</div>
<div class="section level3">
<h3 id="visualization-of-the-joint-z-matrix-for-cancer-and-normal">7.4 Visualization of the joint Z matrix for cancer and Normal<a class="anchor" aria-label="anchor" href="#visualization-of-the-joint-z-matrix-for-cancer-and-normal"></a>
</h3>
<p>Now, we are prepared to visually examine both A matrices for the
separated models derived from cancer and normal samples.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model.alpha.beta.op.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.normal</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.01</span>, beta <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.alpha.beta.op.tumor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_model_from_grid_search_object.html">choose_model_from_grid_search_object</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_search_deco.fixed.w.alpha.list.beta.list.tumors</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.0001</span>, beta <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">model.alpha.beta.op.normal.b</span> <span class="op">&lt;-</span> <span class="va">model.alpha.beta.op.normal</span><span class="op">$</span><span class="va">b</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.normal.b</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Epithelium'</span>, <span class="st">'Stroma'</span>, <span class="st">'Immune'</span><span class="op">)</span></span>
<span><span class="va">model.alpha.beta.op.tumor.b</span> <span class="op">&lt;-</span> <span class="va">model.alpha.beta.op.tumor</span><span class="op">$</span><span class="va">b</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.tumor.b</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Epithelium'</span>, <span class="st">'Stroma'</span>, <span class="st">'Immune'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.alpha.beta.op.cancer.normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.tumor.b</span>, <span class="va">model.alpha.beta.op.normal.b</span><span class="op">)</span></span>
<span></span>
<span><span class="va">palette.v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">palette.v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">color_scheme</span> <span class="op">&lt;-</span> <span class="fu">redgreen</span><span class="op">(</span><span class="fl">75</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Colv</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.cancer.normal</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">t</span> <span class="op">%&gt;%</span> <span class="va">dist</span> <span class="op">%&gt;%</span> <span class="va">hclust</span> <span class="op">%&gt;%</span> <span class="va">as.dendrogram</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">set</span><span class="op">(</span><span class="st">"branches_k_color"</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">set</span><span class="op">(</span><span class="st">"branches_lwd"</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">rotate_DendSer</span><span class="op">(</span>ser_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.cancer.normal</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span><span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                  dendrogram<span class="op">=</span><span class="st">'column'</span>,     </span>
<span>                  Rowv<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                  Colv<span class="op">=</span><span class="va">Colv</span>,</span>
<span>                  col <span class="op">=</span> <span class="va">palette.v1</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Cancer and Normal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.b.matrix.analysis-1.png" width="1920"></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Colv</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.cancer.normal</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">t</span> <span class="op">%&gt;%</span> <span class="va">dist</span> <span class="op">%&gt;%</span> <span class="va">hclust</span> <span class="op">%&gt;%</span> <span class="va">as.dendrogram</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">set</span><span class="op">(</span><span class="st">"branches_k_color"</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">set</span><span class="op">(</span><span class="st">"branches_lwd"</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">rotate_DendSer</span><span class="op">(</span>ser_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot.1</span> <span class="op">&lt;-</span> <span class="fu">gplots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gplots/man/heatmap.2.html" class="external-link">heatmap.2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">model.alpha.beta.op.cancer.normal</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  trace<span class="op">=</span><span class="st">"none"</span>,</span>
<span>                  margins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">12</span><span class="op">)</span>, </span>
<span>                  cexRow <span class="op">=</span> <span class="fl">2</span>, cexCol <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                  dendrogram<span class="op">=</span><span class="st">'column'</span>,     </span>
<span>                  Rowv<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                  Colv<span class="op">=</span><span class="va">Colv</span>,</span>
<span>                  col <span class="op">=</span> <span class="va">palette.v2</span>,</span>
<span>                  main <span class="op">=</span> <span class="st">"Cell types vs samples: matrix B - Cancer and Normal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="DecoFlex_breast_cancer_methylation_core_files/figure-html/decoflex.gridsearch.normal.tumor.plus.z.b.matrix.analysis-2.png" width="1920"></p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot.1</span><span class="op">$</span><span class="va">colDendrogram</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'dendrogram' with 2 branches and 300 members total, at height 8.505432</span></span>
<span></span>
<span></span>
<span><span class="va">Ltrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, <span class="st">"D"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Ltrs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">accumulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>;</span>
<span><span class="va">myleaves</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">anode</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">anode</span><span class="op">)</span><span class="op">)</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">anode</span>,<span class="st">"label"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">accumulator</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">accumulator</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="op">(</span><span class="fu">reduce</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">anode</span>,<span class="va">myleaves</span><span class="op">)</span>,<span class="va">c</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">myleaves</span><span class="op">(</span><span class="va">plot.1</span><span class="op">$</span><span class="va">colDendrogram</span><span class="op">)</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">accumulator</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># partition_leaves(plot.1$colDendrogram)</span></span>
<span><span class="co"># plot.1$colDendrogram %&gt;% get_nodes_attr("label")</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Crhistian Cardona.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
